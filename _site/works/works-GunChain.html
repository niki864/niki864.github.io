<!DOCTYPE html>
<!--
  Original Design: Spectral by HTML5 UP
    html5up.net
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
  Jekyll build mod and further hacks by @arkadianriver, MIT license
-->
<html>

  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chain Gun</title>
  <link rel="icon"  type="image/png"    href="/images/logo.png">
  <meta name="description" content="A conceptual blockchain network for gun ownership">
  <!--[if lte IE 8]><script src="/js/ie/html5shiv.js"></script><![endif]-->
  <link rel="canonical" href="http://localhost:4000/works/works-GunChain.html">
  <link rel="stylesheet" href="/css/main.css" />
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-114852514-1"></script>
  <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-114852514-1');
  </script>

  <!--[if lte IE 8]><link rel="stylesheet" href="/css/ie8.css" /><![endif]-->
  <!--[if lte IE 9]><link rel="stylesheet" href="/css/ie9.css" /><![endif]-->
  <style>
  #main > header {
    background-image: -moz-linear-gradient(top, rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url("/images/guns.jpg");
    background-image: -webkit-linear-gradient(top, rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url("/images/guns.jpg");
    background-image: -ms-linear-gradient(top, rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url("/images/guns.jpg");
    background-image: linear-gradient(top, rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url("/images/guns.jpg");
  }
  </style>
  <!--[if lte IE 9]>
  <style>
  #main > header {
    background-image: url("/images/guns.jpg");
  }
  </style>
  -->
  <link rel="alternate" type="application/rss+xml" title="Nikilesh Kumar" href="http://localhost:4000/feed.xml">

</head>


  <body>

    <!-- Page Wrapper -->
    <div id="page-wrapper">

      <!-- Header -->
<header id="header">
  <h1><a href="/index.html">Nikilesh Kumar</a></h1>
  <nav id="nav">
    <ul>
      <li class="special">
        <a href="#menu" class="menuToggle"><span>Menu</span></a>
        <div id="menu">
          <ul>
            <li><a href="/index.html">Home</a></li>
            <li><a href="/works/">Portfolio</a></li>
            <li><a href="/topics/">Topics</a></li>
            <li><a href="/contact/">Contact</a></li>
            <li><a href="/resume.pdf"> Resume </a></li>

          </ul>
        </div>
      </li>
    </ul>
  </nav>
</header>


      <article id="main">

          <header>
    <h2>Chain Gun</h2>
    <p>A conceptual blockchain network for gun ownership</p>
  </header>
  <ul class="breadcrumb">
  <li><a href="/index.html">Home</a></li>
  <li style="text-transform: capitalize;"><a href="/works">works</a></li>
  <li>Chain Gun</li>
</ul>



          <section class="wrapper style5">
    <div class="inner">
      <span id="post-date">25 March 2018</span><hr
        style="margin-top:3px;" />
      <h4>Skills</h4>
  <ul class="techlist">
<li><span class="tech">Python</span></li>
<li><span class="tech">Requests</span></li>
<li><span class="tech">Flask</span></li>
<li><span class="tech">hashlib</span></li>
<li><span class="tech">json</span></li>
</ul>

  

      <h2 id="chaingun---a-conceptual-blockchain-network-for-gun-ownership">ChainGun - A conceptual blockchain network for gun ownership</h2>

<p>There’s been a lot of talk about gun violence and calls for action against it in social media and through protests such as the <strong>March For Our Lives</strong> movement and more. Hearing about it on a regular basis, I couldn’t help but wonder if there was something that could be done to support this cause. I did some digging around and found <a href="http://www.businessinsider.com/heres-how-cops-actually-trace-a-gun-2016-8">this article</a> by the Business Insider. It’s pretty shocking to hear that even now, gun ownership records are not allowed to be stored in a searchable database. I find it really comical that an officer has to, literally, search though paper records and perform a trace. Hello, 18th Century!</p>

<p>This project here is a manifestation of my desire to effect a change as well as my personal interest in blockchain tech. Here, I conceptualize a theoretical simple blockchain, implemented in Python, that could be used to track gun ownership and transfer of possession. I am following this excellent tutorial listed on hackernoon by <a href="https://hackernoon.com/learn-blockchains-by-building-one-117428612f46">Daniel van Flymen</a>.</p>

<h2 id="summary">Summary</h2>

<p>Most licensed firearms have a serial id. It is this ID that police and ATF officials use, to try and trace the manufacturer and purchase history of the gun. This entire project is based on the concept that each transaction can be encoded into a blockchain and hence, a distribute ledger, and that the transaction can be recorded by all nodes in the system.
Let me first define a few variables in this theoretical transaction system.</p>
<ul>
  <li>Owner - Person/Organization with a firearm for sale: e.g. Acme Firearms Inc.</li>
  <li>Receiver - Person buying a firearm: e.g <strong>John Doe</strong></li>
  <li>Amount - Monetary value paid by <strong>John Doe</strong> for acquiring firearm from Owner</li>
  <li>Gun_ID - Serial ID of firearm being sold.</li>
</ul>

<p>Names can be substituted with some form of ID number for anonymity e.g. Firearms License Card ID Number</p>

<p>Its quite self-explanatory. When John walks up to to Acme Inc. to buy himself a new pistol, he initiates a transaction. The transaction records all these details as one dictionary variable. Now, when John decides to sell his firearm, he becomes the owner and Jane Doe who’s buying his pistol becomes the receiver. Another, transaction is added to the chain.</p>

<p>In these two theoretical transactions, we observe that we can preserve information regarding the gun serial ID while still tracking the movement of the gun from one hand to another.</p>

<p>The ledger nature of a blockchain also allows for John, Jane and Acme to be simultaneously updated about the movement of the gun. Jane can trace the origins of the gun to Acme if necessary.</p>

<h2 id="packages-required">Packages Required</h2>

<p>This project was done in Python3</p>

<ul>
  <li>Requests</li>
  <li>Flask</li>
</ul>

<p>I would also recommend using Postman over cURL for the HTTP client requests.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>A simple of understanding of blockchain basics and python programming is enough to make to implement this project. I would recommend the following guides for more knowledge on blockchain tech and the underlying priciples like Proof of Work, Hashing Algorithms and Network Consensus.</p>

<ul>
  <li>https://bitsonblocks.net/2015/09/09/a-gentle-introduction-to-blockchain-technology/</li>
  <li>https://mlsdev.com/blog/156-how-to-build-your-own-blockchain-architecture</li>
  <li>https://learncryptography.com/hash-functions/what-are-hash-functions</li>
  <li>https://www.youtube.com/watch?v=9mNgeTA13Gc</li>
</ul>

<h2 id="chaingun">ChainGun</h2>

<p>I will be explaining the crucial functions that make this program up</p>

<h3 id="chain-validity">Chain Validity</h3>

<p>This functions seeks to test the validity of the chain</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Chaingun</span><span class="p">:</span>

<span class="o">...</span>

<span class="k">def</span> <span class="nf">valid_chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chain</span><span class="p">):</span>
        <span class="n">last_block</span> <span class="o">=</span> <span class="n">chain</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">current_index</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">while</span> <span class="n">current_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">chain</span><span class="p">):</span>
            <span class="n">block</span> <span class="o">=</span> <span class="n">chain</span><span class="p">[</span><span class="n">current_index</span><span class="p">]</span>
            <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">'{last_block}'</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">'{block}'</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">-----------</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
            <span class="c"># Check that the hash of the block is correct</span>
            <span class="k">if</span> <span class="n">block</span><span class="p">[</span><span class="s">'previous_hash'</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="nb">hash</span><span class="p">(</span><span class="n">last_block</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="c"># Check that the Proof of Work is correct</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_proof</span><span class="p">(</span><span class="n">last_block</span><span class="p">[</span><span class="s">'proof'</span><span class="p">],</span> <span class="n">block</span><span class="p">[</span><span class="s">'proof'</span><span class="p">],</span> <span class="n">last_block</span><span class="p">[</span><span class="s">'previous_hash'</span><span class="p">]):</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="n">last_block</span> <span class="o">=</span> <span class="n">block</span>
            <span class="n">current_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="bp">True</span>

<span class="o">...</span>
</code></pre></div></div>

<p>Here <strong>chain</strong> is the current blockchain and the <strong>return</strong> variable is boolean true or false denoting if the chain passed the validity tests.</p>

<h3 id="network-consensus">Network Consensus</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">resolve_conflicts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">neighbours</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span>
        <span class="n">new_chain</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># Look only for chains longer than current</span>
        <span class="n">max_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="p">)</span>

        <span class="c"># Find and verify the chains from all the nodes in network</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">neighbours</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="s">'http://{node}/chain'</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s">'length'</span><span class="p">]</span>
                <span class="n">chain</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s">'chain'</span><span class="p">]</span>

                <span class="c"># Check to see if length is longer than current and the chain is valid</span>
                <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="n">max_length</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_chain</span><span class="p">(</span><span class="n">chain</span><span class="p">):</span>
                    <span class="n">max_length</span> <span class="o">=</span> <span class="n">length</span>
                    <span class="n">new_chain</span> <span class="o">=</span> <span class="n">chain</span>

        <span class="c"># Replace our chain if we discovered a new, valid chain longer than ours</span>
        <span class="k">if</span> <span class="n">new_chain</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chain</span> <span class="o">=</span> <span class="n">new_chain</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">return</span> <span class="bp">False</span>
</code></pre></div></div>
<p>This is the network consensus algorithm, it resolves conflicts by replacing our chain with the longest one in the network by checking all the other registered nodes.
Our logic here is that the longest chain in the network is the most valid chain.
We <strong>return</strong> True if our chain was replaced, and False if not.</p>

<h3 id="transaction-and-hashing-function">Transaction and Hashing Function</h3>

<p>The transaction function is next. This contains all the information for our transaction.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">new_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">gun_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_transactions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s">'owner'</span><span class="p">:</span> <span class="n">owner</span><span class="p">,</span>
            <span class="s">'receiver'</span><span class="p">:</span> <span class="n">receiver</span><span class="p">,</span>
            <span class="s">'amount'</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
            <span class="s">'gun_id'</span><span class="p">:</span><span class="n">gun_id</span>
            
        <span class="p">})</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_block</span><span class="p">[</span><span class="s">'index'</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div></div>
<p>Creates a new transaction thats queued for the next mined Block</p>
<ul>
  <li>owner: ID of the current gun owner</li>
  <li>receiver: ID of the buyer</li>
  <li>amount: Amount paid in the transaction</li>
  <li>gun_id: Unique gun id for the gun that’s being transacted</li>
  <li>return: The index of the Block that will hold this transaction</li>
</ul>

<p>The hashing function takes all of this information, orders and encodes it performing a standard SHA-256 hash on it.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">hash</span><span class="p">(</span><span class="n">block</span><span class="p">):</span>
        <span class="n">block_string</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">block_string</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="proof-of-work-and-validation-of-pofw">Proof of Work and Validation of PofW</h3>
<p>Every blockchain network needs to have a proper proof of work system for the functioning of the system. Every time a new node is mined, this proof of work algo is what gives legitimacy to it. This PofW algo could be any mathematical equation or problem.
Simple Proof of Work Algorithm:</p>
<ul>
  <li>Find a number p’ such that hash(pp’) contains leading 4 zeroes</li>
  <li>Where p is the previous proof, and p’ is the new proof</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">proof_of_work</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">last_block</span><span class="p">):</span>
        <span class="n">last_proof</span> <span class="o">=</span> <span class="n">last_block</span><span class="p">[</span><span class="s">'proof'</span><span class="p">]</span>
        <span class="n">last_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="nb">hash</span><span class="p">(</span><span class="n">last_block</span><span class="p">)</span>
        <span class="n">proof</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_proof</span><span class="p">(</span><span class="n">last_proof</span><span class="p">,</span> <span class="n">proof</span><span class="p">,</span> <span class="n">last_hash</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">proof</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">proof</span>

   <span class="nd">@staticmethod</span>
   <span class="k">def</span> <span class="nf">valid_proof</span><span class="p">(</span><span class="n">last_proof</span><span class="p">,</span> <span class="n">proof</span><span class="p">,</span> <span class="n">last_hash</span><span class="p">):</span>
        <span class="n">guess</span> <span class="o">=</span> <span class="n">f</span><span class="s">'{last_proof}{proof}{last_hash}'</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">guess_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">guess_hash</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">"0000"</span>
</code></pre></div></div>

<h2 id="demonstration">Demonstration</h2>

<p>Let’s try out how it works! Fire up Postman and do the following.</p>

<p>Initializing: Send a GET request to <code class="highlighter-rouge">/mine</code></p>

<p><img src="https://user-images.githubusercontent.com/10093954/37879823-861c293c-304c-11e8-946b-7221d57973f8.png" alt="Drawing" style="width:100%;" /></p>

<p>Make a new transaction using POST and filling out the transaction details in JSON. Keep owner as the hash id of receiver in previous block <code class="highlighter-rouge">/transactions/new</code>. Mine again. You can add transactions and play around with this.</p>

<p><img src="https://user-images.githubusercontent.com/10093954/37879822-8611d3d8-304c-11e8-8593-dadbcd8899b0.png" alt="Drawing" style="width:100%;" /></p>

<p>Check out the addition in the chain using <code class="highlighter-rouge">/chain</code></p>

<p><img src="https://user-images.githubusercontent.com/10093954/37879819-85f04916-304c-11e8-8681-af039f719d66.png" alt="Drawing" style="width:100%;" /></p>

<p>Change port number from 5000 to 5001 and run another instance of <code class="highlighter-rouge">chaingun.py</code>. Then in a POST request on your old node, register your new node.</p>

<p><img src="https://user-images.githubusercontent.com/10093954/37879818-85e62990-304c-11e8-9a14-96be1b35dcac.png" alt="Drawing" style="width:100%;" /></p>

<p>Add Some transactions to your new node</p>

<p><img src="https://user-images.githubusercontent.com/10093954/37879871-71dbc918-304d-11e8-8113-b0dd450c8e32.png" alt="Drawing" style="width:100%;" /></p>

<p>Try merging using <code class="highlighter-rouge">nodes/resolve</code> and see what you get!</p>

<p><img src="https://user-images.githubusercontent.com/10093954/37879817-85dc3dae-304c-11e8-96f9-e2bb891ae001.png" alt="Drawing" style="width:100%;" /></p>

<h2 id="conclusion">Conclusion</h2>

<p>Obviously, this is not even close to the actual complexity of a real block-chain network like Ethereum. But it was fun learning in depth into blockchain systems and to come up with a simple network that demostrated it. Play around with it on your own systems.</p>

<h2 id="common-issues">Common Issues</h2>

<p>I found that sometimes there were other processes that were still running and occupying ports in my system.
Run this on your CLI: <code class="highlighter-rouge">ps -fA | grep python</code>
This will list the processes running on the port.</p>

<p>You can kill them by entering the process number: <code class="highlighter-rouge">kill &lt;processnumber&gt;</code>. Run chaingun.py after that.</p>

<h2 id="acknowledgments">Acknowledgments</h2>

<ul>
  <li>https://hackernoon.com/learn-blockchains-by-building-one-117428612f46</li>
</ul>

<h2 id="license">License</h2>

<p>This project is licensed under the MIT License. See <a href="https://github.com/niki864/ChainGun/blob/master/LICENSE.md">LICENSE.md</a> for more information.</p>

<p><a href="https://github.com/niki864/ChainGun">Here’s the link to the full github repo</a></p>


      <div class="backnext btnbottom">
                <div class="back">
        <div class="bpointer"><a href="/works/"
         class="button small" title="Back">Index</a></div>
         <!-- class="icon fa-backward" title="Back"></a></div> -->
        <div class="btitle"><a href="/works/">Works Index</a></div>
        </div>
        <div class="next">
        <div class="npointer"><a href="/works/works-bostoncrime.html"
         class="button small" title="Next">Next &gt;</a></div>
         <!-- class="icon fa-forward" title="Next"></a></div> -->
        <div class="ntitle"><a href="/works/works-bostoncrime.html">Boston Crime</a></div>
        </div>

      </div>
      <script>
      document.body.onkeyup = function(e){
        if (e.keyCode == '37') { window.location = '/works/'; }
        if (e.keyCode == '39') { window.location = '/works/works-bostoncrime.html'; }
      };
      </script>

  
    </div>
  </section>


      </article>

      <!-- Footer -->
<footer id="footer">
  <ul class="icons">
    <li><a target="_blank" href="https://twitter.com/trichyflight" class="icon fa-twitter"
           ><span class="label">twitter</span></a></li>
    <li><a target="_blank" href="https://github.com/niki864" class="icon fa-github"
           ><span class="label">github</span></a></li>
    <li><a target="_blank" href="https://linkedin.com/in/nikileshk" class="icon fa-linkedin-square"
           ><span class="label">linkedin-square</span></a></li>
    <li><a target="_blank" href="https://www.facebook.com/nikilesh95" class="icon fa-facebook-official"
           ><span class="label">facebook-official</span></a></li>
    <li><a target="_blank" href="/contact/" class="icon fa-envelope"
           ><span class="label">E-mail</span></a></li>
    <li><a target="_blank" href="https://www.instagram.com/nikileshk/" class="icon fa-instagram"
           ><span class="label">instagram</span></a></li>
  </ul>
  <ul class="copyright">
    <li>&copy; 
    2018
      Nikilesh Kumar</li>
    <li><a href="/credits/">Credits</a></li>
  </ul>
</footer>


      <!-- Scripts -->
<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.scrollex.min.js"></script>
<script src="/js/jquery.scrolly.min.js"></script>
<script src="/js/skel.min.js"></script>
<script src="/js/util.js"></script>
<!--[if lte IE 8]><script src="/js/ie/respond.min.js"></script><![endif]-->
<script src="/js/main.js"></script>

    </div>

  </body>

</html>